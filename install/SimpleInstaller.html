<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniFramework - Instalador Simple</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #0176d3;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #0176d3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .step h3 {
            color: #0176d3;
            margin-top: 0;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background: #0176d3;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #014486;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        pre {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: #28a745;
            transition: width 0.5s ease;
        }
        .installation-status {
            display: none;
        }
        .installation-status.active {
            display: block;
        }
    </style>
</head>
<body>
    <script runat="server">
        Platform.Load("core", "1.1.1");
        
        try {
            var step = Platform.Request.GetFormField("step") || "1";
            var action = Platform.Request.GetFormField("action");
            
            // Configuration from form
            var config = {
                clientId: Platform.Request.GetFormField("clientId"),
                clientSecret: Platform.Request.GetFormField("clientSecret"),
                authBaseUrl: Platform.Request.GetFormField("authBaseUrl"),
                mid: Platform.Request.GetFormField("mid") || ""
            };
            
            Variable.SetValue("@currentStep", step);
            Variable.SetValue("@config", Stringify(config));
            
            // Simple installation function based on ssjs-lib pattern
            function performInstallation(authConfig) {
                try {
                    var results = {
                        timestamp: new Date().toISOString(),
                        success: false,
                        created: [],
                        errors: [],
                        summary: ""
                    };
                    
                    // Get authentication token first
                    var tokenUrl = authConfig.authBaseUrl + "v2/token";
                    var tokenPayload = {
                        "grant_type": "client_credentials",
                        "client_id": authConfig.clientId,
                        "client_secret": authConfig.clientSecret
                    };
                    
                    var tokenRequest = new Script.Util.HttpRequest(tokenUrl);
                    tokenRequest.emptyContentHandling = 0;
                    tokenRequest.retries = 1;
                    tokenRequest.continueOnError = true;
                    tokenRequest.contentType = "application/json";
                    tokenRequest.method = "POST";
                    tokenRequest.postData = Stringify(tokenPayload);
                    
                    var tokenResponse = tokenRequest.send();
                    
                    if (tokenResponse.statusCode != 200) {
                        results.errors.push("Authentication failed: " + tokenResponse.statusCode);
                        return results;
                    }
                    
                    var tokenData = Platform.Function.ParseJSON(tokenResponse.content);
                    var accessToken = tokenData.access_token;
                    var restUrl = tokenData.rest_instance_url;
                    
                    // Content Blocks to create (simplified versions)
                    var contentBlocks = [
                        {
                            name: "MF_ResponseWrapper",
                            content: getResponseWrapperContent()
                        },
                        {
                            name: "MF_AuthHandler", 
                            content: getAuthHandlerContent()
                        },
                        {
                            name: "MF_ConnectionHandler",
                            content: getConnectionHandlerContent()
                        },
                        {
                            name: "MF_DataExtensionHandler",
                            content: getDataExtensionHandlerContent()
                        },
                        {
                            name: "MF_EmailHandler",
                            content: getEmailHandlerContent()
                        },
                        {
                            name: "MF_AssetHandler",
                            content: getAssetHandlerContent()
                        },
                        {
                            name: "MF_FolderHandler",
                            content: getFolderHandlerContent()
                        },
                        {
                            name: "MF_LogHandler",
                            content: getLogHandlerContent()
                        },
                        {
                            name: "MF_AssetCreator",
                            content: getAssetCreatorContent()
                        }
                    ];
                    
                    // Create each Content Block
                    var createdCount = 0;
                    for (var i = 0; i < contentBlocks.length; i++) {
                        var block = contentBlocks[i];
                        
                        var createUrl = restUrl + "/asset/v1/content/assets";
                        var createPayload = {
                            "name": block.name,
                            "assetType": {
                                "name": "codesnippetblock",
                                "id": 220
                            },
                            "content": block.content,
                            "meta": {
                                "framework": "MiniFramework",
                                "version": "1.0.0"
                            }
                        };
                        
                        var createRequest = new Script.Util.HttpRequest(createUrl);
                        createRequest.emptyContentHandling = 0;
                        createRequest.retries = 1;
                        createRequest.continueOnError = true;
                        createRequest.contentType = "application/json";
                        createRequest.method = "POST";
                        createRequest.setHeader("Authorization", "Bearer " + accessToken);
                        createRequest.postData = Stringify(createPayload);
                        
                        var createResponse = createRequest.send();
                        
                        if (createResponse.statusCode >= 200 && createResponse.statusCode < 300) {
                            results.created.push(block.name);
                            createdCount++;
                        } else {
                            results.errors.push(block.name + ": " + createResponse.statusCode + " - " + createResponse.content);
                        }
                    }
                    
                    // Create basic Data Extensions using WSProxy (more reliable)
                    try {
                        createBasicDataExtensions();
                        results.created.push("Data Extensions");
                    } catch (deEx) {
                        results.errors.push("Data Extensions: " + deEx.message);
                    }
                    
                    results.success = createdCount > 0;
                    results.summary = "Created " + createdCount + " of " + contentBlocks.length + " Content Blocks";
                    
                    return results;
                    
                } catch (ex) {
                    return {
                        success: false,
                        errors: ["Installation exception: " + ex.message],
                        summary: "Installation failed with exception"
                    };
                }
            }
            
            function createBasicDataExtensions() {
                var proxy = new Script.Util.WSProxy();
                
                // Logs DE
                var logsDE = {
                    "Name": "MiniFramework_Logs",
                    "CustomerKey": "miniframework_logs", 
                    "Description": "MiniFramework logging storage",
                    "IsSendable": false,
                    "IsTestable": false,
                    "Fields": [
                        {"Name": "LogId", "FieldType": "Number", "IsPrimaryKey": true, "IsRequired": true, "IsIdentity": true},
                        {"Name": "Timestamp", "FieldType": "Date", "IsRequired": true},
                        {"Name": "Level", "FieldType": "Text", "MaxLength": 10, "IsRequired": true},
                        {"Name": "Message", "FieldType": "Text", "MaxLength": 500, "IsRequired": true},
                        {"Name": "Source", "FieldType": "Text", "MaxLength": 100},
                        {"Name": "Data", "FieldType": "Text", "MaxLength": 4000}
                    ]
                };
                
                proxy.createItem("DataExtension", logsDE);
                
                // Config DE
                var configDE = {
                    "Name": "MiniFramework_Config",
                    "CustomerKey": "miniframework_config",
                    "Description": "MiniFramework configuration storage", 
                    "IsSendable": false,
                    "IsTestable": false,
                    "Fields": [
                        {"Name": "ConfigKey", "FieldType": "Text", "MaxLength": 100, "IsPrimaryKey": true, "IsRequired": true},
                        {"Name": "ConfigValue", "FieldType": "Text", "MaxLength": 4000, "IsRequired": true},
                        {"Name": "Description", "FieldType": "Text", "MaxLength": 500},
                        {"Name": "LastUpdated", "FieldType": "Date", "IsRequired": true}
                    ]
                };
                
                proxy.createItem("DataExtension", configDE);
            }
            
            // Simplified Content Block sources
            function getResponseWrapperContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n\\nfunction MiniFrameworkResponse() {\\n    function createResponse(success, data, error, handler, operation) {\\n        return {\\n            success: success || false,\\n            data: data || null,\\n            error: error || null,\\n            meta: {\\n                timestamp: new Date().toISOString(),\\n                handler: handler || "unknown",\\n                operation: operation || "unknown"\\n            }\\n        };\\n    }\\n    \\n    return {\\n        success: function(data, handler, operation) {\\n            return createResponse(true, data, null, handler, operation);\\n        },\\n        error: function(code, message, details, handler, operation) {\\n            return createResponse(false, null, {code: code, message: message, details: details}, handler, operation);\\n        }\\n    };\\n}\\n</script>';
            }
            
            function getAuthHandlerContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n%%=ContentBlockByKey("MF_ResponseWrapper")=%%\\n\\nfunction MiniFrameworkAuthHandler(config) {\\n    var response = new MiniFrameworkResponse();\\n    \\n    function getToken() {\\n        try {\\n            var tokenUrl = config.authBaseUrl + "v2/token";\\n            var request = new Script.Util.HttpRequest(tokenUrl);\\n            request.method = "POST";\\n            request.contentType = "application/json";\\n            request.postData = Stringify({\\n                "grant_type": "client_credentials",\\n                "client_id": config.clientId,\\n                "client_secret": config.clientSecret\\n            });\\n            \\n            var httpResponse = request.send();\\n            \\n            if (httpResponse.statusCode == 200) {\\n                var tokenData = Platform.Function.ParseJSON(httpResponse.content);\\n                return response.success(tokenData, "AuthHandler", "getToken");\\n            } else {\\n                return response.error("AUTH_FAILED", "Authentication failed", {statusCode: httpResponse.statusCode}, "AuthHandler", "getToken");\\n            }\\n        } catch (ex) {\\n            return response.error("EXCEPTION", ex.message, {exception: ex}, "AuthHandler", "getToken");\\n        }\\n    }\\n    \\n    return { getToken: getToken };\\n}\\n</script>';
            }
            
            function getConnectionHandlerContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n%%=ContentBlockByKey("MF_ResponseWrapper")=%%\\n\\nfunction MiniFrameworkConnectionHandler() {\\n    var response = new MiniFrameworkResponse();\\n    \\n    function request(url, options) {\\n        try {\\n            var opts = options || {};\\n            var httpRequest = new Script.Util.HttpRequest(url);\\n            httpRequest.method = opts.method || "GET";\\n            \\n            if (opts.headers) {\\n                for (var header in opts.headers) {\\n                    httpRequest.setHeader(header, opts.headers[header]);\\n                }\\n            }\\n            \\n            if (opts.data) {\\n                httpRequest.postData = typeof opts.data === "string" ? opts.data : Stringify(opts.data);\\n            }\\n            \\n            var httpResponse = httpRequest.send();\\n            \\n            return response.success({\\n                statusCode: httpResponse.statusCode,\\n                content: httpResponse.content\\n            }, "ConnectionHandler", "request");\\n            \\n        } catch (ex) {\\n            return response.error("EXCEPTION", ex.message, {exception: ex}, "ConnectionHandler", "request");\\n        }\\n    }\\n    \\n    return { request: request };\\n}\\n</script>';
            }
            
            function getDataExtensionHandlerContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n%%=ContentBlockByKey("MF_ResponseWrapper")=%%\\n\\nfunction MiniFrameworkDataExtensionHandler() {\\n    var response = new MiniFrameworkResponse();\\n    \\n    function addRecord(deKey, recordData) {\\n        try {\\n            var de = DataExtension.Init(deKey);\\n            var result = de.Rows.Add(recordData);\\n            return response.success({rowsAdded: result}, "DataExtensionHandler", "addRecord");\\n        } catch (ex) {\\n            return response.error("EXCEPTION", ex.message, {exception: ex}, "DataExtensionHandler", "addRecord");\\n        }\\n    }\\n    \\n    return { addRecord: addRecord };\\n}\\n</script>';
            }
            
            function getEmailHandlerContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n%%=ContentBlockByKey("MF_ResponseWrapper")=%%\\n%%=ContentBlockByKey("MF_AuthHandler")=%%\\n%%=ContentBlockByKey("MF_ConnectionHandler")=%%\\n\\nfunction MiniFrameworkEmailHandler(authConfig) {\\n    var response = new MiniFrameworkResponse();\\n    var auth = new MiniFrameworkAuthHandler(authConfig);\\n    var connection = new MiniFrameworkConnectionHandler();\\n    \\n    function list() {\\n        try {\\n            var tokenResult = auth.getToken();\\n            if (!tokenResult.success) return tokenResult;\\n            \\n            var token = tokenResult.data;\\n            var url = token.rest_instance_url + "/asset/v1/content/assets?$filter=assetType.name eq \\'htmlemail\\'";\\n            \\n            var requestResult = connection.request(url, {\\n                method: "GET",\\n                headers: { "Authorization": token.token_type + " " + token.access_token }\\n            });\\n            \\n            if (requestResult.success) {\\n                var data = Platform.Function.ParseJSON(requestResult.data.content);\\n                return response.success(data.items || [], "EmailHandler", "list");\\n            }\\n            return requestResult;\\n        } catch (ex) {\\n            return response.error("EXCEPTION", ex.message, {exception: ex}, "EmailHandler", "list");\\n        }\\n    }\\n    \\n    return { list: list };\\n}\\n</script>';
            }
            
            function getAssetHandlerContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n%%=ContentBlockByKey("MF_ResponseWrapper")=%%\\n%%=ContentBlockByKey("MF_AuthHandler")=%%\\n%%=ContentBlockByKey("MF_ConnectionHandler")=%%\\n\\nfunction MiniFrameworkAssetHandler(authConfig) {\\n    var response = new MiniFrameworkResponse();\\n    var auth = new MiniFrameworkAuthHandler(authConfig);\\n    var connection = new MiniFrameworkConnectionHandler();\\n    \\n    function list() {\\n        try {\\n            var tokenResult = auth.getToken();\\n            if (!tokenResult.success) return tokenResult;\\n            \\n            var token = tokenResult.data;\\n            var url = token.rest_instance_url + "/asset/v1/content/assets";\\n            \\n            var requestResult = connection.request(url, {\\n                method: "GET",\\n                headers: { "Authorization": token.token_type + " " + token.access_token }\\n            });\\n            \\n            if (requestResult.success) {\\n                var data = Platform.Function.ParseJSON(requestResult.data.content);\\n                return response.success(data.items || [], "AssetHandler", "list");\\n            }\\n            return requestResult;\\n        } catch (ex) {\\n            return response.error("EXCEPTION", ex.message, {exception: ex}, "AssetHandler", "list");\\n        }\\n    }\\n    \\n    return { list: list };\\n}\\n</script>';
            }
            
            function getFolderHandlerContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n%%=ContentBlockByKey("MF_ResponseWrapper")=%%\\n%%=ContentBlockByKey("MF_AuthHandler")=%%\\n%%=ContentBlockByKey("MF_ConnectionHandler")=%%\\n\\nfunction MiniFrameworkFolderHandler(authConfig) {\\n    var response = new MiniFrameworkResponse();\\n    var auth = new MiniFrameworkAuthHandler(authConfig);\\n    var connection = new MiniFrameworkConnectionHandler();\\n    \\n    function list() {\\n        try {\\n            var tokenResult = auth.getToken();\\n            if (!tokenResult.success) return tokenResult;\\n            \\n            var token = tokenResult.data;\\n            var url = token.rest_instance_url + "/asset/v1/content/categories";\\n            \\n            var requestResult = connection.request(url, {\\n                method: "GET",\\n                headers: { "Authorization": token.token_type + " " + token.access_token }\\n            });\\n            \\n            if (requestResult.success) {\\n                var data = Platform.Function.ParseJSON(requestResult.data.content);\\n                return response.success(data.items || [], "FolderHandler", "list");\\n            }\\n            return requestResult;\\n        } catch (ex) {\\n            return response.error("EXCEPTION", ex.message, {exception: ex}, "FolderHandler", "list");\\n        }\\n    }\\n    \\n    return { list: list };\\n}\\n</script>';
            }
            
            function getLogHandlerContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n%%=ContentBlockByKey("MF_ResponseWrapper")=%%\\n\\nfunction MiniFrameworkLogHandler() {\\n    var response = new MiniFrameworkResponse();\\n    \\n    function error(message, source, data) {\\n        try {\\n            var logEntry = {\\n                Timestamp: new Date().toISOString(),\\n                Level: "ERROR",\\n                Message: message,\\n                Source: source || "unknown",\\n                Data: data ? Stringify(data) : null\\n            };\\n            \\n            try {\\n                var de = DataExtension.Init("miniframework_logs");\\n                de.Rows.Add(logEntry);\\n            } catch (deEx) {\\n                // Silent fail for DE logging\\n            }\\n            \\n            return response.success(logEntry, "LogHandler", "error");\\n        } catch (ex) {\\n            return response.error("EXCEPTION", ex.message, {exception: ex}, "LogHandler", "error");\\n        }\\n    }\\n    \\n    function info(message, source, data) {\\n        return error(message, source, data); // Simplified - same logic\\n    }\\n    \\n    return { error: error, info: info };\\n}\\n</script>';
            }
            
            function getAssetCreatorContent() {
                return '<script runat="server">\\nPlatform.Load("core", "1.1.1");\\n%%=ContentBlockByKey("MF_ResponseWrapper")=%%\\n\\nfunction MiniFrameworkAssetCreator() {\\n    var response = new MiniFrameworkResponse();\\n    \\n    function createAllAssets() {\\n        try {\\n            return response.success({\\n                message: "Asset creation available via main installer"\\n            }, "AssetCreator", "createAllAssets");\\n        } catch (ex) {\\n            return response.error("EXCEPTION", ex.message, {exception: ex}, "AssetCreator", "createAllAssets");\\n        }\\n    }\\n    \\n    return { createAllAssets: createAllAssets };\\n}\\n</script>';
            }
            
            // Execute installation if requested
            if (action === "install" && config.clientId && config.clientSecret && config.authBaseUrl) {
                var installResult = performInstallation(config);
                Variable.SetValue("@installResult", Stringify(installResult, null, 2));
                Variable.SetValue("@currentStep", "3");
            }
            
        } catch (ex) {
            Variable.SetValue("@installError", ex.message);
        }
    </script>

    <div class="container">
        <h1>üöÄ MiniFramework - Instalador Simple</h1>
        
        <script runat="server">
            var currentStep = Variable.GetValue("@currentStep") || "1";
            var config = Variable.GetValue("@config");
            var installResult = Variable.GetValue("@installResult");
            var installError = Variable.GetValue("@installError");
            
            if (currentStep == "1") {
                Write('<div class="step">');
                Write('<h3>Paso 1: Configuraci√≥n de Credenciales</h3>');
                Write('<p>Introduce las credenciales de tu Installed Package de Salesforce Marketing Cloud.</p>');
                Write('<form method="POST">');
                Write('<input type="hidden" name="step" value="2">');
                Write('<div class="form-group">');
                Write('<label for="clientId">Client ID *</label>');
                Write('<input type="text" id="clientId" name="clientId" required placeholder="Tu Client ID">');
                Write('</div>');
                Write('<div class="form-group">');
                Write('<label for="clientSecret">Client Secret *</label>');
                Write('<input type="password" id="clientSecret" name="clientSecret" required placeholder="Tu Client Secret">');
                Write('</div>');
                Write('<div class="form-group">');
                Write('<label for="authBaseUrl">Auth Base URL *</label>');
                Write('<input type="text" id="authBaseUrl" name="authBaseUrl" required value="https://YOUR_SUBDOMAIN.auth.marketingcloudapis.com/" placeholder="https://YOUR_SUBDOMAIN.auth.marketingcloudapis.com/">');
                Write('</div>');
                Write('<div class="form-group">');
                Write('<label for="mid">MID (opcional)</label>');
                Write('<input type="text" id="mid" name="mid" placeholder="Member ID (opcional)">');
                Write('</div>');
                Write('<button type="submit">Continuar al Paso 2</button>');
                Write('</form>');
                Write('</div>');
            }
            
            if (currentStep == "2" && config) {
                var configObj = Platform.Function.ParseJSON(config);
                Write('<div class="step">');
                Write('<h3>Paso 2: Confirmar Instalaci√≥n</h3>');
                Write('<p>Se van a crear los siguientes componentes:</p>');
                Write('<ul>');
                Write('<li><strong>9 Content Blocks:</strong> ResponseWrapper, AuthHandler, ConnectionHandler, DataExtensionHandler, EmailHandler, AssetHandler, FolderHandler, LogHandler, AssetCreator</li>');
                Write('<li><strong>2 Data Extensions:</strong> MiniFramework_Logs, MiniFramework_Config</li>');
                Write('</ul>');
                Write('<div class="warning">');
                Write('<h4>‚ö†Ô∏è Importante:</h4>');
                Write('<ul>');
                Write('<li>Aseg√∫rate de tener permisos para crear Content Blocks y Data Extensions</li>');
                Write('<li>La instalaci√≥n puede tardar unos minutos</li>');
                Write('<li>Si ya existen componentes con los mismos nombres, la instalaci√≥n puede fallar</li>');
                Write('</ul>');
                Write('</div>');
                Write('<form method="POST">');
                Write('<input type="hidden" name="step" value="3">');
                Write('<input type="hidden" name="action" value="install">');
                Write('<input type="hidden" name="clientId" value="' + configObj.clientId + '">');
                Write('<input type="hidden" name="clientSecret" value="' + configObj.clientSecret + '">');
                Write('<input type="hidden" name="authBaseUrl" value="' + configObj.authBaseUrl + '">');
                Write('<input type="hidden" name="mid" value="' + configObj.mid + '">');
                Write('<button type="submit" style="background: #28a745;">üöÄ Comenzar Instalaci√≥n</button>');
                Write('<a href="?" style="margin-left: 10px; text-decoration: none; color: #0176d3;">‚Üê Volver al Paso 1</a>');
                Write('</form>');
                Write('</div>');
            }
            
            if (currentStep == "3") {
                Write('<div class="step">');
                Write('<h3>Paso 3: Resultado de la Instalaci√≥n</h3>');
                
                if (installError) {
                    Write('<div class="error">');
                    Write('<h4>‚ùå Error durante la instalaci√≥n</h4>');
                    Write('<p>' + installError + '</p>');
                    Write('</div>');
                } else if (installResult) {
                    var result = Platform.Function.ParseJSON(installResult);
                    
                    if (result.success) {
                        Write('<div class="success">');
                        Write('<h4>‚úÖ Instalaci√≥n Completada</h4>');
                        Write('<p><strong>' + result.summary + '</strong></p>');
                        
                        if (result.created && result.created.length > 0) {
                            Write('<h5>Componentes creados exitosamente:</h5>');
                            Write('<ul>');
                            for (var i = 0; i < result.created.length; i++) {
                                Write('<li>' + result.created[i] + '</li>');
                            }
                            Write('</ul>');
                        }
                        
                        Write('<div class="info">');
                        Write('<h5>üìã Pr√≥ximos pasos:</h5>');
                        Write('<ol>');
                        Write('<li>Ve a Content Builder ‚Üí Content Blocks y verifica los bloques con prefijo "MF_"</li>');
                        Write('<li>Revisa las Data Extensions creadas: MiniFramework_Logs, MiniFramework_Config</li>');
                        Write('<li>Ya puedes usar el framework en tus CloudPages y emails</li>');
                        Write('</ol>');
                        Write('</div>');
                        Write('</div>');
                    } else {
                        Write('<div class="error">');
                        Write('<h4>‚ùå Instalaci√≥n con errores</h4>');
                        Write('<p>' + result.summary + '</p>');
                        
                        if (result.errors && result.errors.length > 0) {
                            Write('<h5>Errores encontrados:</h5>');
                            Write('<ul>');
                            for (var j = 0; j < result.errors.length; j++) {
                                Write('<li>' + result.errors[j] + '</li>');
                            }
                            Write('</ul>');
                        }
                        Write('</div>');
                    }
                    
                    Write('<details style="margin-top: 20px;">');
                    Write('<summary>Ver detalles t√©cnicos</summary>');
                    Write('<pre>' + installResult + '</pre>');
                    Write('</details>');
                }
                
                Write('<a href="?" style="margin-top: 20px; display: inline-block; text-decoration: none; color: #0176d3;">‚Üê Nueva Instalaci√≥n</a>');
                Write('</div>');
            }
        </script>

        <div class="info">
            <h4>üìö Acerca de MiniFramework</h4>
            <p>Framework simplificado para Salesforce Marketing Cloud basado en ssjs-lib, que proporciona:</p>
            <ul>
                <li>Handlers modulares para Email, Data Extensions, Assets y Folders</li>
                <li>Sistema de autenticaci√≥n unificado</li>
                <li>Response wrapper est√°ndar para todas las operaciones</li>
                <li>Logging centralizado y configurable</li>
                <li>Patr√≥n de instancia familiar (similar a EMAIL360)</li>
            </ul>
        </div>
    </div>
</body>
</html>